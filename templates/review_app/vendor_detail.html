{% extends "base.html" %}
{% load review_tags %}
{% block title %}
    {{ object.vendor_name }}
{% endblock %}
{% block head %}
    <style media="screen">
    .fm-hero {
         background: url({{ object.vendor_banner_picture_url }});
         height: 15em;
    }
    </style>
{% endblock %}

{% block hero %}
    <div class="fm-hero">
        <h1 class="hero-text text-center"><strong>{{ object.vendor_name }}</strong></h1>
    </div>
{% endblock %}

{% block body %}
<hr>
<div class="row">
    <div class="small-4 columns">
        <img src="{{ object.vendor_picture_url }}" alt="{{ object.vendor_name }} Profile Picture" />
    </div>
    <div class="small-4 columns">
        <h3>Avg Review info here</h3>
        <p>Stars....</p>
        {# Link for review plug in #}
        <a href="{% url "review_create" content_type='vendor' object_id=vendor.pk %}">review this vendor</a>
    </div>
    <div class="small-4 columns">
        <a class="large button success radius" href="{% url 'rating_vendor_create_view' object.vendor_slug %}">Add a Review</a>
    </div>
</div>
<hr>
<div class="row">
    <div class="small-6 columns">
        <p>{% if object.vendor_type %}<strong>Vendor Type:</strong> {{ object.vendor_type }}{% endif %}<br>
            <br>
            {{ object.vendor_description }}<br>
        </p>
    </div>
    <div class="small-6 columns">
        {% if object.vendor_website %}
        <a class="secondary hollow button" href="{{ object.vendor_website }}"><strong>Website</strong></a><br>
        {% endif %}
        <strong>Found at these Farmers Markets: </strong><br>
        {% for fm in object.at_farmers_market.all %}
            <a href="{% url 'farmers_market_detail_view' fm.fm_slug %}">{{ fm }}</a><br>
        {% endfor %}</p>
    </div>
</div>
<hr>
<div class="row">
    <div class="small-7 columns boarder-right">
        <h2>REVIEWS........</h2>
        {# Start Review plug in code #}
        {% total_review_average object 100 as percentage %}
        <p>{{ percentage }}% of our users recommended this!</p>

        {% total_review_average object 5 as stars %}
        <p>This object got {{ stars }} out of 5 stars.</p>

        <hr>
        {% get_review_count object as review_count %}
        <p>{{ review_count }} users have reviewed this so far.</p>
        <hr>
        {% user_has_reviewed object request.user as has_reviewed %}
        {% if has_reviewed %}
            <p>Thanks for your opinion!</p>
        {% else %}
            <a href="{% url "review_create" content_type='vendor' object_id=vendor.pk %}">"Review this book"</a>
        {% endif %}
        <hr>
        {# End Review Plug in Info #}
        {% get_reviews object as reviews %}
        {% for review in reviews %}
            <div class="callout">
                <p>{{ review.get_average_rating }}</p>
                <p>{% if review.content %}
                        {{ review.content|truncatewords:'70' }}
                    {% else %}
                        Reviewed without description.
                    {% endif %}</p>
                <a href="{% url "review_detail" pk=object.pk %}">Review details</a>
            </div>
        {% endfor %}
<hr>
        {% get_review_average object as review_average %}
        <p>This object is rated by {{ review_average }}</p>
<hr>
        {% for review in rating_list %}
            <div class="callout">
                <span class="success badge"><strong>{{ review.rating }}</strong></span>
                {{ review.rating_comment }}<br>
                <small>{{ review.rating_user }}</small>
                <small class="float-right">{{ review.rating_created }}</small>
            </div>
        {% endfor %}
    </div>
    <div class="small-5 columns">
        <p><strong>Contact: </strong>{{ object.vendor_contact_name }}<br>
        <strong>Phone: </strong>{{ object.vendor_phone }}<br>
        <small><strong>updated: </strong>{{ object.vendor_updated }}</small></p>
        {% if request.user == object.vendor_user %}
            <a class="button" href="{% url 'vendor_update_view' object.vendor_slug %}">Update This Listing</a>
        {% endif %}
    </div>
</div>


{% endblock %}
